Изучение NoSQL базы Кассандра.
=========

В этом репозитарии находятся примеры изучения как следует использовать Кассандру .

Для удобства, проект разделен на модули. Каждый модуль демонстрирует метод решения конкретной задачи.

CheckClaster
----
#####Базовая проверка кластера кассандры на работоспособность. 
После развертывания кластера необходимо убедиться, что он работоспособен и все ноды кластера работают корректно.
На кластер можно подать нагрузку с помощью штатной утилиты от DataStax и произвести мониторинг. А можно подстраховаться и воспользоваться этой утилитой :)
Идея утилиты следующая, производиться запись информации, после чего производится чтение информации и ее сверка. Для этого делается следующее:
- Создаем пространство ключей с репликацией на все ноды кластера.
- Создаем таблицу c строковым ключом main_id(рандомное значение), временем вставки и неким значением.
- Многопоточно пишем данные в эту таблицу. Консистентность записи ONE. Параллельно многопоточно читаем данные. Имитируем нагрузку. После чего производим чтение данных и проверяем сколько строк было записано и на какая сумма значения была записана. Полученные значения сверяем с эталонными. Консистентность чтения ALL. Если при работе модуля возникло больше количество ошибок или же он вообще не смог отработать, то следует заняться настройкой кластера.

#####Параметры командной строки
```
--host Адресс кластера кассандры, без порта.
--numberOfThread Количество нитей обновления. Максимум 128, по умолчанию 10.
--time Сколько времени записывать/читать данные, в секундах. Максимум 86400.
-?, -h, Справка о программе
```
#####Параметры запуска VM
```
-DconsoleEncoding=Кодировка, по умолчанию используется CP866
```
Собираем проект.

Для удобства проект собирается в один исполняемый jar.


```
mvn clean:package
```
Пример запуска.
```
java.exe -DconsoleEncoding=CP866 -jar CheckClaster.one-jar.jar --host 127.0.0.1 --time 5 --numberOfThread 2
Запускаем писателей.
Запускаем читателей.
Строковый ключ: 643419
Писатели:
UUID                                    Сумма Vol                       Всего таймаутов                 Не удалось обновить счетчики    Вставлено записей               Вставок в секунду
------------------------------------    ----------------------------    ----------------------------    ----------------------------    ----------------------------    ----------------------------
32e7d39f-e425-4f23-8a92-da33db76bcbe    57611                           0                               0                               1156                            230
66c27f00-f0e2-446e-a54e-8cfb2daa3541    58745                           0                               0                               1177                            234
------------------------------------    ----------------------------    ----------------------------    ----------------------------    ----------------------------    ----------------------------
                                        116356                          0                               0                               2333                            464
------------------------------------    ----------------------------    ----------------------------    ----------------------------    ----------------------------    ----------------------------
```
Необходимо обратить внимание на количество ошибок(таймаутов) при вставке данных. Особенно если в колонке "Не удалось обновить" значения отличные от  0. В этом случае необходимо проверить работоспособность нод кластера и настроить времена ожидания.
```
Читатели:
UUID                                    -//-                            Всего таймаутов                 Не удалось прочитать счетчики   Считано записей                 Чтений в секунду
------------------------------------    ----------------------------    ----------------------------    ----------------------------    ----------------------------    ----------------------------
ef22d56a-fe01-411e-87de-29232c9fd52d    115433                          3280                            0                               277923                          55253
439df722-acf3-49cf-b485-a0807bf7f1f7    115983                          3380                            0                               288711                          57329
------------------------------------    ----------------------------    ----------------------------    ----------------------------    ----------------------------    ----------------------------
                                                                        6660                            0                               566634                          112582
------------------------------------    ----------------------------    ----------------------------    ----------------------------    ----------------------------    ----------------------------
```
Аналогично выше написанному. То что суммарное значение во второй колонке отличается от суммы того, что записано в кассандру, это нормально. Кассандра предполагает что данные будут консистенты в далекой перспективе.
```
Контрольное чтение.
UUID                                    Сумма Vol                       Разница с эталон                Считано записей                 Разница с эталон
------------------------------------    ----------------------------    ----------------------------    ----------------------------    ----------------------------
d12d6d0d-3c8e-4824-95fe-34614ac607d5    116356                          0                               2333                            0
f995d929-b17d-4cb6-b47a-bb7a12c91089    116356                          0                               2333                            0
------------------------------------    ----------------------------    ----------------------------    ----------------------------    ----------------------------
```
А вот тут в колонках "Разница с эталон" должны быть 0, если же значения отличны от 0, то необходимо настроить времена ожидания  и проверить, не понижает ли автоматически драйвер уровень консистентности, он может!
```
Скорость записи: 464 значений в сек.
Таймаутов при записи в секунду: 0

Скорость чтения: 112582 значений в сек
Таймаутов при чтении в секунду: 1323
```
Теоритически скорость записи и скорость чтения должны быть сопоставимы, но на  моей виртуалке я вижу вот такую картину.